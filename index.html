<html>
<head>
	<title>Target Hit</title>

	<style type="text/css">
		#mycanvas{
			background-color: #e0ccff;
		}
		body{
			background-color: #e0ccff;
		}
	</style>
</head>

<body onload="startGame();">
	<canvas id="mycanvas" width="1350" height="620"></canvas>

	<script type="text/javascript">
		var bullet;
		var flag; //initially: 0  ; 2 when mouse inside range
		var click; //initially: 0 ; 1 when mouse clicked inside range(bullet fires)
		var range;
		var guide;
		var target;
		var score=0;
		var highScore=0;
		var hit;
		var scorecard;
		var audio1,audio2,audio3,audio4;
		

		var startGame = function(){
			flag=0;
			click=0;
			hit=0;

			audio1=new sound("sounds/swoosh.wav");
			audio2=new sound("sounds/gameover.flac");
			audio3=new sound("sounds/hit.wav");
			audio4=new sound("sounds/highscore.wav");
			range=new component(180,420,130,"","line");
			guide=new component(180,420,5,"","guide");
			var x=(Math.random()*800)+400;
			var y=(Math.random()*30)+520;
			target=new component2(x,y);
			bullet=new component(180,420,12,"#009999","circ");
			scorecard=new component3(150,50);
			//highScoreCard=new component3(900,50);
			myGameArea.start();
		};


		var myGameArea = {
			canvas : document.getElementById("mycanvas"),
			start : function(){
				this.context=this.canvas.getContext("2d");
				interval = setInterval(updateGameArea,80);
			},
			clear:function(){
				this.context.clearRect(0,0,this.canvas.width,this.canvas.height);
			}
		};

		var updateGameArea = function(){
			
			myGameArea.clear();
			
			
			
			if(bullet.y>=(myGameArea.canvas.height-70) && ((bullet.x<(target.x-100))|| (bullet.x>(target.x+100)))){
						score=0;
						audio2.play();
						fadeOut("Game Over!")
						clearInterval(interval);
						startGame();
			}
			else if((bullet.x>(target.x-100))&& (bullet.x<(target.x+100)) && (bullet.y>(target.y-35))){
						hit=1;
						if((bullet.x>(target.x-25))&& (bullet.x<(target.x+25)) && (bullet.y>(target.y-6)))
							score+=20;
						else if((bullet.x>(target.x-60))&& (bullet.x<(target.x+60)) && (bullet.y>(target.y-14)))
							score+=15;
						else if((bullet.x>(target.x-80))&& (bullet.x<(target.x+80)) && (bullet.y>(target.y-25)))
							score+=10;
						else
							score+=5;
						if(score>highScore){
							audio4.play();
							highScore=score;
						}
						else{
							audio3.play();
						}
						fadeOut("Score!");
						clearInterval(interval);
						startGame();

			}
			else{
				bullet.newPos();
				range.update();
				guide.update();
				target.update1();
				bullet.update();
			}
			scorecard.update2();

		};


		function sound(src) {
		    this.sound = document.createElement("audio");
		    this.sound.src = src;
		    this.sound.setAttribute("preload", "auto");
		    this.sound.setAttribute("controls", "none");
		    this.sound.style.display = "none";
		    document.body.appendChild(this.sound);
		    this.play = function(){
		        this.sound.play();
		    }
		}

		//object to store mouse x and y position
		var mouse = {  
			x:undefined,
			y:undefined
		};

		var mousex,mousey,distx,disty,dist;

		/*mousex: instantaneous x position of mouse
		  mousey: instantaneous y position of mouse
		  distx: instantaneous x distance b/w mouse and bullet
		  distx: instantaneous y distance b/w mouse and bullet
		  dist: instantaneous exact distance b/w mouse and bullet*/
		

		addEventListener("mousemove",function(event){
				mousex=event.x;
				mousey=event.y;
				distx=bullet.x-mousex;
				disty=mousey-bullet.y;
				dist=Math.sqrt(distx*distx+disty*disty);
				if(dist<=120 && click!=1){
					ctx=myGameArea.context;
					ctx.beginPath();
					ctx.arc(mousex,mousey,8,0,Math.PI * 2);
					ctx.fillStyle = "green";
					ctx.fill();
					flag=2;
				}
		});


		var bx,by,dx,dy,angle,v,vx,vy,gravity,angle;

		/*bx : initial x position of bullet when fired
		  bx : initial y position of bullet when fired
		  dx : x distance b/w mouse and bullet when fired
		  dy : y distance b/w mouse and bullet when fired
		   v : actual distance b/w mouse and bullet when fired
	   angle : angle at which the bullet is fired
		  vx : delta change of bullet along x after being fired
		  vy : delta change of bullet along y after being fired*/
		
		addEventListener("click",function(event){
			if(flag==2 && click!=1){
				mouse.x=event.x;
				mouse.y=event.y;
				bx=bullet.x;
				by=bullet.y;
				dx=bx-mouse.x;
				dy=mouse.y-by;
				gravity=10;
				v=Math.sqrt(dx*dx+dy*dy)/10;
				angle=Math.atan2(dx,dy); //in RADIANS
				vx=v*Math.sin(angle);
				vy=v*Math.cos(angle);
				angle=angle*180/Math.PI; //in DEGREES
				click=1;
				audio1.play();
			}

		});

		function component3(x,y){
			var text1="Score : ";
			var text2="High-Score : ";
			var instruction;
			this.x=x;
			this.y=y;
			this.update2 = function(){
				txt=myGameArea.context;
				txt.font="30px Comic Sans MS";
				txt.fillStyle = "#009999";
				txt.textAlign = "center";
				txt.fillText(text1+score,this.x,this.y);

				hscore=myGameArea.context;
				hscore.font="30px Comic Sans MS";
				hscore.fillStyle = "#8c1aff";
				hscore.textAlign = "center";
				hscore.fillText(text2+highScore,500,50);

				rule=myGameArea.context;
				rule.font="25px Comic Sans MS";
				rule.fillStyle = "#5900b3";
				rule.textAlign = "left";
				instruction="Drag and position the"; 
				rule.fillText(instruction,1000,this.y);
				instruction="mouse within the range"; 
				rule.fillText(instruction,990,this.y+30);
				instruction="to adjust angle and velocity"; 
				rule.fillText(instruction,970,this.y+60);
				instruction="CLICK to fire!"; 
				rule.fillText(instruction,1060,this.y+100);
			};
		};

		function component2(x,y){
		
			this.x=x;
			this.y=y;
			this.update1 = function(){
				t1=myGameArea.context;
				t2=myGameArea.context;
				t3=myGameArea.context;
				t4=myGameArea.context;

				t1.beginPath();
				t1.ellipse(this.x,this.y,100,35,0,0,Math.PI*2);
				t1.fillStyle = "#cc0000";
				t1.fill();
				t1.strokeStyle="black";
				t1.stroke();

				t2.beginPath();
				t2.ellipse(this.x,this.y,80,25,0,0,Math.PI*2);
				t2.fillStyle = "#ffffff";
				t2.fill();
				t2.strokeStyle="black";
				t2.stroke();

				t3.beginPath();
				t3.ellipse(this.x,this.y,60,14,0,0,Math.PI*2);
				t3.fillStyle = "#cc0000";
				t3.fill();
				t3.strokeStyle="black";
				t3.stroke();

				t4.beginPath();
				t4.ellipse(this.x,this.y,25,6,0,0,Math.PI*2);
				t4.fillStyle = "#ffffff";
				t4.fill();
				t4.strokeStyle="black";
				t4.stroke();
			};
		};

		function component(x,y,radius,color,type){
			this.x=x;
			this.y=y;
			this.radius=radius;
			this.color=color;
			this.type=type;

			this.update = function(){

				if(this.type=="circ"){
					ctx1=myGameArea.context;
					ctx1.beginPath();
					ctx1.arc(this.x,this.y,this.radius,0,Math.PI * 2);
					ctx1.fillStyle = this.color;
					ctx1.fill();
				}
				else if(this.type=="guide" && dist<=120){
					ctx2=myGameArea.context;
					ctx2.beginPath();
					ctx2.moveTo(this.x,this.y);
					ctx2.lineTo(mousex,mousey);
					if(click==1)
					ctx2.strokeStyle="#e0ccff"
					else
					ctx2.strokeStyle="#e6ffe6";
					ctx2.stroke();
				}
				else
				{
					ctx3=myGameArea.context;
					ctx3.beginPath();
					ctx3.arc(this.x,this.y,this.radius,0,Math.PI * 2);
					ctx3.strokeStyle="red";
					ctx3.stroke();
				}

			};


			this.newPos = function(){
				if(click==1){


					if(angle<=90 && angle>=-90){
						
						this.x+=7*vx;
						this.y-=gravity+6*vy;
						vy-=1;
						
					}					
					else
					{
						this.x+=2*vx;
						this.y+=gravity-vy;
						vy-=1;
						
					}
					
				}
				
			};
		};

		function fadeOut(text) {
    	var alpha = 1.0,  
        interval3 = setInterval(function () {
	            msg=myGameArea.context;
	            msg.textAlign="center";
	            msg.fillStyle = "rgba(255, 140, 26, " + alpha + ")";
	            msg.font = "italic 100px Arial";
	            msg.fillText(text, myGameArea.canvas.width/2, myGameArea.canvas.height/2);
	            alpha = alpha - 0.05; 
	            if (alpha < 0) {clearInterval(interval3);
	            }
	        }, 50); 
   		}



	</script>
</body>
</html>
